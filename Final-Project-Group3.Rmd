---
title: "Final-Project-Group3"
author: "John M. Musah & Alan R. Galloway"
date: "11/1/2021"
output: html_document
---



# LINEAR REGRESSION

# estimating beta
```{r}
#' @title Least Square Estimator-group3 
#'
#' @description We create a function of the OLS estimator of the coefficients called beta_hats. 
#' @param Dependent A \code{vector} with the values for the dependent variable (or outcome variable).
#' @param Independent A \code{matrix} with the values for the independent variable.
#' @return A \code{numeric}.
#' @author John M. Musah & Alan R. Galloway
#' @importFrom 
#' @export
#' @examples
#' Using data("USArrests")
#' coeff_lm(USArrests$Murder,USArrests$UrbanPop)

#library(MASS)

coeff_beta <- function (Dependent, Independent) {
  
  library(MASS)
  #-------------------------------- preamble -------------------------------------
  # in case user gets something that is not a vector for 'Dependent'
  #  or a matrix for 'Independent', coerce data:
  Dependent <- as.vector(Dependent)
  Independent <- as.matrix(cbind(1,Independent))
  
  beta <- solve(t(Independent)%*%Independent)%*%t(Independent)%*%Dependent
  
  return(beta)

 
}

coeff_beta(USArrests$Murder,USArrests$UrbanPop)

```



# confidence interval
```{r}
#' @title Linear Model Function-group3
#'
#' @description We create a function of the OLS estimator of the coefficients called beta_hats. 
#' @param Dependent A \code{vector} with the values for the dependent variable (or outcome variable).
#' @param Independent A \code{matrix} with the values for the independent variable.
#' @param Beta A \code{matrix} that can be calculated using \code{coeff_lm} function.!
#' @param alpha A \code{numeric} (double) that sets the alpha coefficient to be used. Has to be between 0 and 1.
#' @param method A \code{string} that defines the method used. Options are "Asymptotic" and "Bootstrap", accepts minor misspellings with a warning - which can be both good and bad.
#' @return A \code{list} containing the following attributes:
#' \describe{
#'      \item{beta}{Estimated coefficients, Linear Regression Model.}
#'      \item{sigma2}{explanation}
#'      \item{variance_beta}{explanation}
#'      \item{ci}{explanation}
#' }
#' @author John M. Musah & Alan R. Galloway
#' @importFrom 
#' @export
#' @examples
#' Using data("USArrests")
#' coeff_lm(USArrests$Murder,USArrests$UrbanPop)

coeff_ci <- function (Dependent, Independent, alpha = 0.05) {
  
  beta <- coeff_beta(USArrests$Murder, USArrests$UrbanPop)
  b <- beta
  Dependent <- as.vector(USArrests$Murder)
  Independent <- as.matrix(USArrests$UrbanPop)
  n <- length(Dependent)
  p <- dim(Independent)[2]
  degrees_freedom <- n - p
  Independent <- as.matrix(cbind(1,USArrests$UrbanPop))
  
  #resid
  resid <- Dependent - Independent%*%as.matrix(b)
  
  #sigma2.hat
  sigma2.hat <- (1/degrees_freedom) * t(resid) %*% resid
  
  #var.beta
  var.beta <- as.numeric(sigma2.hat)*solve(t(Independent)%*%Independent)
  
  #quant
  quant <- 1 - alpha/2
  
  a <- beta - qnorm(p = quant)
  a <- as.numeric(a)
  
  c <- sqrt(var.beta)
  c <- t(b)
  c <- as.numeric(b)
  
  d <- beta + qnorm(p = quant)
  d <- as.matrix(d)
  d <- as.numeric(d)
  #nonconforming arrays?
  ci.beta <- c(a%*%c, d%*%c)
  
  return(ci.beta)
}
 
coeff_ci(USArrests$Murder,USArrests$UrbanPop)
```



# f-test
```{r}
#' @title Linear Model Function-group3
#'
#' @description Function that 
#' @param Dependent A \code{vector} with the values for the dependent variable (also called outcome).
#' @param Independent A \code{matrix} with the values for the independent variable (also called predictors, or explanatory variable).
#' @param Beta A \code{matrix} that can be calculated using \code{coeff_lm} function.!
#' @param alpha A \code{numeric} (double) that sets the alpha coefficient to be used. Has to be between 0 and 1.
#' @param method A \code{string} that defines the method used. Options are "Asymptotic" and "Bootstrap", accepts minor misspellings with a warning - which can be both good and bad.
#' @return A \code{list} containing the following attributes:
#' \describe{
#'      \item{beta}{Estimated coefficients, Linear Regression Model.}
#'      \item{sigma2}{explanation}
#'      \item{variance_beta}{explanation}
#'      \item{ci}{explanation}
#' }
#' @author John M. Musah & Alan R. Galloway
#' @importFrom 
#' @export
#' @examples
#' Using data("USArrests")
#' coeff_lm(USArrests$Murder,USArrests$UrbanPop)

coeff_ftest <- function (Dependent, Independent) {
  
   #--------------------------------------------------------------------------
  #-------------------------------- preamble --------------------------------
  
  # in case user gets something that is not a vector for 'Dependent'
  #  or a matrix for 'Independent', coerce data:
  #
  beta <- coeff_beta(Dependent, Independent)
  b <- beta
  Dependent <- as.vector(Dependent)
  Independent <- as.matrix(Independent)
  n <- length(Dependent)
  sample_mean <- mean(Dependent)
  Ind <- cbind(1,Independent)
  y_hat <- Ind%*% as.matrix(b)
  fit <- Ind%*%as.matrix(b)
  p <- dim(Ind)[2]
  degrees_freedom <- n - p
  
  DFM <- p - 1
  DFE <- n - p
  SSM <- sum((y_hat - sample_mean)^2)
  
  MSM <- SSM/DFM
  
  SSE <- sum((Dependent - y_hat)^2)
  
  MSE <- SSE/DFE
  #--------------------------------------------------------------------------
  
  # check and warnings:
  # 
  if(n != dim(Independent)[1])
    
    stop("Can you check the correspondence between x and y values? It seems we do not have proper pairs! If in doubt, check the documentation using ?coeff_least_sq")
  #--------------------------------------------------------------------------
  
  f_stat <- MSM/MSE
 
  f_prob <- pf(f_stat, DFM, DFE, lower.tail = FALSE)
  f_info <- rbind(f_stat, DFM, DFE, f_prob)
  rownames(f_info) <- c("F Stat: ","Lower DF: ","Higher DF:","P-Value: ")
  return(f_info) 
  
}

coeff_ftest(USArrests$Murder,USArrests$UrbanPop)



```



# r-squared
```{r}
#' @title functon for r squared predicted error-group3
#'
#' @description Function that 
#' @param Dependent A \code{vector} with the values for the dependent variable (also called outcome).
#' @param Independent A \code{matrix} with the values for the independent variable (also called predictors, or explanatory variable).
#' @param Beta A \code{matrix} that can be calculated using \code{coeff_lm} function.!
#' @param alpha A \code{numeric} (double) that sets the alpha coefficient to be used. Has to be between 0 and 1.
#' @param method A \code{string} that defines the method used. Options are "Asymptotic" and "Bootstrap", accepts minor misspellings with a warning - which can be both good and bad.
#' @return A \code{list} containing the following attributes:
#' \describe{
#'      \item{beta}{Estimated coefficients, Linear Regression Model.}
#'      \item{sigma2}{explanation}
#'      \item{variance_beta}{explanation}
#'      \item{ci}{explanation}
#' }
#' @author John M. Musah & Alan R. Galloway
#' @importFrom 
#' @export
#' @examples
#' Using data("USArrests")
#' coeff_lm(USArrests$Murder,USArrests$UrbanPop)


coeff_rsquared <- function (Dependent, Independent) {
  
  #--------------------------------------------------------------------------
  #-------------------------------- preamble --------------------------------
  
  # in case user gets something that is not a vector for 'Dependent'
  #  or a matrix for 'Independent', coerce data:
  #
  beta <- coeff_beta(Dependent, Independent)
  b <- beta
  Dependent <- as.vector(Dependent)
  Independent <- as.matrix(Independent)
  n <- length(Dependent)
  p <- dim(Independent)[2]
  degrees_freedom <- n - p
  sample_mean <- mean(Dependent)
  Ind <- cbind(1,Independent)
  y_hat <- Ind%*% as.matrix(b)
  fit <- Ind%*%as.matrix(b)
  
  #--------------------------------------------------------------------------
  # Define base and dummy parameters:
  
  SSE <- sum((Dependent - y_hat)^2)
  SST <- sum((Dependent - sample_mean)^2)

  r_squared <- 1 - SSE/SST
  
  return(r_squared)
  
}
coeff_rsquared(USArrests$Murder,USArrests$UrbanPop)
```



# mallows cp
```{r}
#' @title functon for r squared predicted error-group3
#'
#' @description Function that 
#' @param Dependent A \code{vector} with the values for the dependent variable (also called outcome).
#' @param Independent A \code{matrix} with the values for the independent variable (also called predictors, or explanatory variable).
#' @param Beta A \code{matrix} that can be calculated using \code{coeff_lm} function.!
#' @param alpha A \code{numeric} (double) that sets the alpha coefficient to be used. Has to be between 0 and 1.
#' @param method A \code{string} that defines the method used. Options are "Asymptotic" and "Bootstrap", accepts minor misspellings with a warning - which can be both good and bad.
#' @return A \code{list} containing the following attributes:
#' \describe{
#'      \item{beta}{Estimated coefficients, Linear Regression Model.}
#'      \item{sigma2}{explanation}
#'      \item{variance_beta}{explanation}
#'      \item{ci}{explanation}
#' }
#' @author John M. Musah & Alan R. Galloway
#' @importFrom 
#' @export
#' @examples
#' Using data("USArrests")
#' coeff_lm(USArrests$Murder,USArrests$UrbanPop)


coeff_mallows_Cp <- function (Dependent, Independent) {
  
  #--------------------------------------------------------------------------
  #-------------------------------- preamble --------------------------------
  
  # in case user gets something that is not a vector for 'Dependent'
  #  or a matrix for 'Independent', coerce data:
  #
  beta <- coeff_beta(Dependent, Independent)
  b <- beta
  Dependent <- as.vector(Dependent)
  Independent <- as.matrix(Independent)
  n <- length(Dependent)
  p <- dim(Independent)[2]
  degrees_freedom <- n - p
  sample_mean <- mean(Dependent)
  Ind <- cbind(1,Independent)
  y_hat <- Ind%*% as.matrix(b)
  fit <- Ind%*%as.matrix(b)
  
  #--------------------------------------------------------------------------
  # Define base and dummy parameters:
  
  SSE <- sum((Dependent - y_hat)^2)
  
  #resid
  resid <- Dependent - Ind%*%as.matrix(b)
  
  #sigma2.hat
  sigma2.hat <- (1/degrees_freedom) * t(resid) %*% resid
  
  #--------------------------------------------------------------------------
  # check and warnings:
  # 
  if(n != dim(Independent)[1])
    
    stop("Can you check the correspondence between x and y values? It seems we do not have proper pairs! If in doubt, check the documentation using ?coeff_least_sq")
  #--------------------------------------------------------------------------
  
  mallows <- SSE +2*p*sigma2.hat
  
  return(mallows)
  
}

coeff_mallows_Cp(USArrests$Murder,USArrests$UrbanPop)

```



# plot
```{r}
#' @title Plot function for coeff lm package-group3
#'
#' @description Function that 
#' @param Dependent A \code{vector} with the values for the dependent variable (also called outcome).
#' @param Independent A \code{matrix} with the values for the independent variable (also called predictors, or explanatory variable).
#' @param Beta A \code{matrix} that can be calculated using \code{coeff_lm} function.!
#' @param alpha A \code{numeric} (double) that sets the alpha coefficient to be used. Has to be between 0 and 1.
#' @param method A \code{string} that defines the method used. Options are "Asymptotic" and "Bootstrap", accepts minor misspellings with a warning - which can be both good and bad.
#' @return A \code{list} containing the following attributes:
#' \describe{
#'      \item{beta}{Estimated coefficients, Linear Regression Model.}
#'      \item{sigma2}{explanation}
#'      \item{variance_beta}{explanation}
#'      \item{ci}{explanation}
#' }
#' @author John M. Musah & Alan R. Galloway
#' @importFrom 
#' @export
#' @examples
#' data("USArrests")
#' coeff_plot(USArrests$Murder,USArrests$UrbanPop)
#' 
#' The actual function begins therefrom:




coeff_plot <- function (Dependent, Independent) {
  #--------------------------------------------------------------------------
  #-------------------------------- preamble --------------------------------
  
  # in case user gets something that is not a vector for 'Dependent'
  #  or a matrix for 'Independent', coerce data:
  # 
  beta <- coeff_beta(Dependent, Independent)
  Dependent <- as.matrix(Dependent)
  Independent <- as.matrix(cbind(1,Independent))
  #--------------------------------------------------------------------------
  # Define base and dummy parameters:
  # 
  n <- length(Dependent)
  p <- dim(Independent)[2]
  degrees_freedom <- n - p
  ci_beta <- rep(NA, p)
  size <- 1000
  residual <- Dependent - Independent%*%as.matrix(beta)
  fit <- Independent%*%beta
  #--------------------------------------------------------------------------
  # check and warnings:
  # 
  if(n != dim(Independent)[1])
    
    stop("Can you check the correspondence between x and y values? It seems we do not have proper pairs! If in doubt, check the documentation using ?coeff_least_sq")
  #--------------------------------------------------------------------------
  #
  
  par(mfrow=c(1,3),oma = c(1,0,1,0))
  plot(residual~fit, xlab="Residual Values",ylab="Fitted Values",main="Residuals vs Fitted")
  qqnorm(residual)
  HistResVFit=hist(residual, xlab = "Residual Values", ylab="Frequency")
  title(line = -2)
  
}
```





```{r}
Model <- lm(USArrests$Murder~ USArrests$UrbanPop)
summary(Model)

```



#REFERENCES
#https://economictheoryblog.com/2016/02/20/rebuild-ols-estimator-manually-in-r/
#https://github.com/andrewc94/Linear-Regression-in-R
#https://stackoverflow.com/questions/40901445/function-to-calculate-r2-r-squared-in-r


```{r}
data("USArrests")
coeff_beta(USArrests$Murder,USArrests$UrbanPop)
#coeff_ci(USArrests$Murder,USArrests$UrbanPop)
coeff_ftest(USArrests$Murder,USArrests$UrbanPop)
coeff_rsquared(USArrests$Murder,USArrests$UrbanPop)
coeff_mallows_Cp(USArrests$Murder,USArrests$UrbanPop)
coeff_plot(USArrests$Murder,USArrests$UrbanPop)

```





#THE R PACKAGE
```{r}

```






















